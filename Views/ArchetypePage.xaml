<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:CharactersOfCthulhu.Models"
             xmlns:viewmodels="clr-namespace:CharactersOfCthulhu.ViewModels"
             x:DataType="viewmodels:ArchetypePageViewModel"
             x:Class="CharactersOfCthulhu.Views.ArchetypePage"
             Title="Select Archetype">

    <Grid RowDefinitions="*,Auto">
        <ScrollView Grid.Row="0">
            <VerticalStackLayout Padding="10" Spacing="5">
                <Label Text="Select Pulp Archetype" 
                       FontSize="22" 
                       FontAttributes="Bold"
                       Padding="10,0" />

                <CollectionView ItemsSource="{Binding Archetypes}"
                                SelectionMode="Single"
                                SelectedItem="{Binding SelectedArchetype, Mode=TwoWay}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="viewmodels:ArchetypeViewModel">

                            <Frame Margin="10,5" Padding="0" CornerRadius="5">
                                <Frame.Triggers>
                                    <DataTrigger TargetType="Frame"
                                                 Binding="{Binding IsExpanded}"
                                                 Value="True">
                                        <Setter Property="BorderColor" Value="{StaticResource Primary}" />
                                        <Setter Property="Background" Value="#22FFFFFF" />
                                    </DataTrigger>
                                    <DataTrigger TargetType="Frame"
                                                 Binding="{Binding IsExpanded}"
                                                 Value="False">
                                        <Setter Property="BorderColor" Value="Gray" />
                                        <Setter Property="Background" Value="Transparent" />
                                    </DataTrigger>
                                </Frame.Triggers>

                                <VerticalStackLayout Spacing="0">

                                    <Label Text="{Binding Name}"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           Margin="10" />

                                    <VerticalStackLayout Padding="10" 
                                                         Margin="0,-10,0,10" 
                                                         Spacing="15"
                                                         IsVisible="{Binding IsExpanded}">

                                        <Label Text="{Binding Description}"
                                               FontSize="14" />

                                        <VerticalStackLayout Spacing="5" 
                                                             IsVisible="{Binding ShowCoreCharacteristicChoice}">
                                            <Label Text="Select Core Characteristic" FontAttributes="Bold" />
                                            <Picker ItemsSource="{Binding CoreCharacteristicChoices}"
                                                    SelectedItem="{Binding SelectedCoreCharacteristic}"
                                                    Title="Select Stat" />
                                        </VerticalStackLayout>

                                    </VerticalStackLayout>

                                </VerticalStackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>

        <Grid Grid.Row="1" ColumnDefinitions="*,*" Padding="10">
            <Button Grid.Column="0"
                    Text="Back"
                    Command="{Binding GoBackCommand}"
                    HorizontalOptions="Start" />
            <Button Grid.Column="1"
                    Text="Next"
                    Command="{Binding GoToNextPageCommand}"
                    HorizontalOptions="End" />
        </Grid>
    </Grid>
</ContentPage>